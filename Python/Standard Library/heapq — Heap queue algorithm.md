---
alias: heapq
tags:
 - python
 - heap
 - standardlibrary
---

Модуль `heapq` предоставляет реализацию алгоритма **очереди кучи**, также известный как алгоритм **очереди с приоритетом**.

**Кучи** — это бинарные деревья, где каждый родительский узел хранит значение меньшее или равное значению каждого из его дочерних узлов. Данная реализация использует массив элементов, где для каждого элемента начиная с нуля справедливо условие:

$$
el_{k} \le el_{2*k+1} \land el_{k} \le el_{2*k+2}
$$

Для простоты сравнения, несуществующие в контексте кучи элементы считаются равными бесконечности. Также, одним из интересных свойств кучи является факт — корневой узел кучи обладает наименьшим значением по сравнению с остальными элементами кучи.  

Интерфейс `heapq` имеет ряд отличий от "книжных" версий алгоритма:

- **Индексирование узлов начинается с нуля** — в этом случае связь между индексом текущего узла и индексами его дочерних узлов становится менее очевидной, однако подходит лучше для реализации на [[Python]], где индексирование элементов массивов начинается с нуля
- **Извлечение элементов слева** — метод `pop` возвращает наименьший элемент в куче (корневой элемент кучи или элемент с индексом `0`) вместо наибольшего (последнего элемента в куче), для реализации `in-place` сортировки внутри очереди.

Эти два отличия позволяют представлять очередь в виде обычного массива `Python` без каких либо сюрпризов: первый элемент в массиве — это корневой элемент кучи с наименьшим значением в куче, а также поддерживают инвариантность сортировки кучи. 

```Python
>>> import heapq

>>> heap = [5, 7, 1, 4, 3]

>>> heapq.heapify(heap) # initializing heap in-place
>>> print(heap)
[1, 3, 5, 4, 7]

>>> heapq.heappop(heap) # pop smallest element in heap
1
>>> print(heap)
[3, 4, 5, 7]

>>> heapq.heappush(heap, 2) # push the value into the heap
>>> print(heap)
[2, 3, 5, 7, 4]
```

## Список источников

- [heapq — Heap queue algorithm](https://docs.python.org/3/library/heapq.html)